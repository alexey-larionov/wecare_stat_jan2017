colnames(gq.df) <- sub(".GQ", "", colnames(gq.df))
colnames(dp.df) <- sub(".DP", "", colnames(dp.df))
# Clean-up
rm(source_data_folder, prefix, covar_file, demographics_file, samples_file, vv_file, gt_file, gq_file, dp_file, kgen_file, exac_file, phenotypes_update_file, BRCA1_BRCA2_PALB2_cases_file)
dim(gt.df)
str(gt.df, list.len=5)
gt.df[1:5,1:5]
dim(gq.df)
str(gq.df, list.len=5)
gq.df[1:5,1:5]
dim(dp.df)
str(dp.df, list.len=5)
dp.df[1:5,1:5]
dim(covar.df)
str(covar.df)
covar.df[1:5,1:5]
dim(samples.df)
str(samples.df)
samples.df[1:5,]
dim(demographics.df)
str(demographics.df)
demographics.df[1:5,1:5]
dim(phenotypes_update.df)
str(phenotypes_update.df)
phenotypes_update.df[1:5,1:5]
dim(BRCA1_BRCA2_PALB2_cases.df)
str(BRCA1_BRCA2_PALB2_cases.df)
BRCA1_BRCA2_PALB2_cases.df[1:5,1:5]
dim(vv.df)
str(vv.df)
vv.df[1:5,1:5]
dim(kgen.df)
str(kgen.df)
kgen.df[1:5,1:5]
dim(exac.df)
str(exac.df)
exac.df[1:5,1:5]
gt.mx <- as.matrix(gt.df)
gq.mx <- as.matrix(gq.df)
dp.mx <- as.matrix(dp.df)
dim(gt.mx)
class(gt.mx)
gt.mx[1:5,1:5]
dim(gq.mx)
class(gq.mx)
gq.mx[1:5,1:5]
dim(dp.mx)
class(dp.mx)
dp.mx[1:5,1:5]
rm(gt.df, gq.df, dp.df)
# rownames
sum(rownames(gt.mx) != rownames(gq.mx))
sum(rownames(gt.mx) != rownames(dp.mx))
sum(rownames(gt.mx) != rownames(vv.df))
sum(rownames(gt.mx) != rownames(kgen.df))
sum(rownames(gt.mx) != rownames(exac.df))
# colnames
sum(colnames(gt.mx) != colnames(gq.mx))
sum(colnames(gt.mx) != colnames(dp.mx))
NA -> vv.df[vv.df$Existing_variation == "", "Existing_variation"] # no blanks in other fields
NA -> covar.df[covar.df == ""] # 1 case in chemo_hormone (row 84)
NA -> demographics.df[demographics.df == ""] # 2 cases in registry and one in chemo_hormone
NA -> BRCA1_BRCA2_PALB2_cases.df[BRCA1_BRCA2_PALB2_cases.df == ""] # 8 cases in notes
# No blanks in other tables
# Converst factors to vectors (to symplify comparisons)
str(phenotypes_update.df)
as.character(phenotypes_update.df$gwas_id) -> phenotypes_update.df$gwas_id
as.character(phenotypes_update.df$wes_id) -> phenotypes_update.df$wes_id
trimws(as.character(phenotypes_update.df$hist_cat)) -> phenotypes_update.df$hist_cat
trimws(as.character(phenotypes_update.df$chemo_cat)) -> phenotypes_update.df$chemo_cat
as.character(phenotypes_update.df$er1) -> phenotypes_update.df$er1
as.character(phenotypes_update.df$pr1) -> phenotypes_update.df$pr1
as.character(phenotypes_update.df$hormone) -> phenotypes_update.df$hormone
NA -> phenotypes_update.df[phenotypes_update.df$er1 == "missing", "er1"]
NA -> phenotypes_update.df[phenotypes_update.df$pr1 == "missing", "pr1"]
NA -> phenotypes_update.df[phenotypes_update.df$hormone == "missing", "hormone"]
as.numeric(phenotypes_update.df$er1) -> phenotypes_update.df$er1
as.numeric(phenotypes_update.df$pr1) -> phenotypes_update.df$pr1
as.numeric(phenotypes_update.df$hormone) -> phenotypes_update.df$hormone
str(phenotypes_update.df)
save.image(paste(interim_data_folder, "r01_read_and_clean_data_jan2017.RData", sep="/"))
ls()
sessionInfo()
Sys.time()
rm(list=ls())
# Time stamp
Sys.time()
# Folders
setwd("/scratch/medgen/scripts/wecare_stat_01.17/scripts")
interim_data_folder <- "/scratch/medgen/scripts/wecare_stat_01.17/interim_data"
# Thresholds for genotypes
min.gq <- 20
max.dp <- 500
# Variants call ratethreshold
min.call.rate <- 0.8
load(paste(interim_data_folder, "r01_read_and_clean_data_jan2017.RData", sep="/"))
dim(gt.mx)
class(gt.mx)
gt.mx[1:5,1:5]
dim(gq.mx)
class(gq.mx)
gq.mx[1:5,1:5]
dim(dp.mx)
class(dp.mx)
dp.mx[1:5,1:5]
dim(covar.df)
str(covar.df)
covar.df[1:5,1:5]
dim(samples.df)
str(samples.df)
samples.df[1:5,]
dim(demographics.df)
str(demographics.df)
demographics.df[1:5,1:5]
dim(phenotypes_update.df)
str(phenotypes_update.df)
phenotypes_update.df[1:5,1:5]
dim(BRCA1_BRCA2_PALB2_cases.df)
str(BRCA1_BRCA2_PALB2_cases.df)
BRCA1_BRCA2_PALB2_cases.df[1:5,1:5]
dim(vv.df)
str(vv.df)
vv.df[1:5,1:5]
dim(kgen.df)
str(kgen.df)
kgen.df[1:5,1:5]
dim(exac.df)
str(exac.df)
exac.df[1:5,1:5]
# Check consistence of rownames
sum(rownames(gt.mx) != rownames(gq.mx))
sum(rownames(gt.mx) != rownames(dp.mx))
sum(rownames(gt.mx) != rownames(vv.df))
sum(rownames(gt.mx) != rownames(kgen.df))
sum(rownames(gt.mx) != rownames(exac.df))
# Check consistence of colnames
sum(colnames(gt.mx) != colnames(gq.mx))
sum(colnames(gt.mx) != colnames(dp.mx))
# Fraction of NA genotypes before filtering
sum(is.na(gt.mx))/(dim(gt.mx)[1]*dim(gt.mx)[2]) # ~4%
# Call rates per variant before filtering
x <- ncol(gt.mx)
y <- apply(gt.mx,1,function(z){1-sum(is.na(z))/x})
hist(y, breaks=50, xlab=NULL, main="Call rates per variant before genotypes filtering")
# Histogram of gq  before filtering (when gt is not NA !)
hist(gq.mx[!is.na(gt.mx)], breaks=50, main="Histogram of gq in non-NA genotypes (before filtering)", xlab=NULL)
# Histogram of dp before filtering (when gt is not NA !)
hist(dp.mx[!is.na(gt.mx)], breaks=50, main="Histogram of dp in non-NA genotypes (before filtering)", xlab=NULL)
hist(dp.mx[!is.na(gt.mx)], breaks=2500, xlim=c(0,100), main="Histogram of dp in non-NA genotypes (before filtering, 0:100)", xlab=NULL)
rm(x,y)
# num of genotypes to be removed
sum(gq.mx < min.gq, na.rm=TRUE)
# Fraction of genotypes to be removed
sum(gq.mx < min.gq, na.rm=TRUE)/sum(!is.na(gq.mx)) # ~8%
# Apply filter (to gt only !)
NA -> gt.mx[ gq.mx < min.gq ]
# Clean up
rm(min.gq)
dim(gt.mx)
# Fraction of NA genotypes after filtering
sum(is.na(gt.mx))/(dim(gt.mx)[1]*dim(gt.mx)[2]) # ~12%
# Call rates per variant after gq filtering
x <- ncol(gt.mx)
y <- apply(gt.mx, 1, function(z){1-sum(is.na(z))/x})
hist(y, xlab=NULL, main="Histogram of call rates per variant after gt filtering")
# Histogram of gq  after gq filtering (when gt is not NA !)
hist(gq.mx[!is.na(gt.mx)], xlim=c(0,100), breaks=50, main="Histogram of gq in non NA genotypes (after gq filtering)", xlab=NULL)
View(vv.df)
# Histogram of dp after gt filtering (when gt is not NA !)
hist(dp.mx[!is.na(gt.mx)], breaks=50, main="Histogram of dp in non-NA genotypes (after gt filtering)", xlab=NULL)
hist(dp.mx[!is.na(gt.mx)], xlim=c(0,100), breaks=2500, main="Histogram of dp in non-NA genotypes (after gt filtering, 0:100)", xlab=NULL)
# Clean up
rm(x, y)
# num of genotypes to be removed
sum(dp.mx > max.dp, na.rm=TRUE)
# Fraction of genotypes to be removed (appr)
sum(dp.mx > max.dp, na.rm=TRUE)/sum(!is.na(gq.mx)) # <<1%
# Apply filter (to gt only !)
NA -> gt.mx[ dp.mx > max.dp ]
# Clean up
rm(max.dp)
dim(gt.mx)
# Fraction of NA genotypes after filtering
sum(is.na(gt.mx))/(dim(gt.mx)[1]*dim(gt.mx)[2]) # ~12%
# Call rates per variant after gq filtering
x <- ncol(gt.mx)
y <- apply(gt.mx, 1, function(z){1-sum(is.na(z))/x})
hist(y, xlab=NULL, main="Call rates per variant after gt+dp filtering")
# Histogram of gq  after gq+dp filtering (when gt is not NA !)
hist(gq.mx[!is.na(gt.mx)], xlim=c(0,100), breaks=50, main="Histogram of gq in non-NA genotypes (after gq+dp filtering)", xlab=NULL)
# Histogram of dp after gt filtering (when gt is not NA !)
hist(dp.mx[!is.na(gt.mx)], breaks=50, main="Histogram of dp after gt+dp filtering", xlab=NULL)
hist(dp.mx[!is.na(gt.mx)], xlim=c(0,100), breaks=500, main="Histogram of dp in non-NA genotypes (after gt+dp filtering, 0:100)", xlab=NULL)
# Clean up
rm(x, y)
# Estimate the proportion of variants to be removed
x <- ncol(gt.mx)
y <- apply(gt.mx, 1, function(z){1-sum(is.na(z))/x})
y[1:7]
var.retained <- y >= min.call.rate
sum(var.retained) # 283.651
1 - sum(var.retained)/nrow(gt.mx) # ~18%
# Remove variants with loaw call rates
gt.mx <- gt.mx[ var.retained, ]
dp.mx <- dp.mx[ var.retained, ]
gq.mx <- gq.mx[ var.retained, ]
vv.df <- vv.df[ var.retained, ]
kgen.df <- kgen.df[ var.retained, ]
exac.df <- exac.df[ var.retained, ]
# Clean-up
rm(min.call.rate, var.retained, x, y)
dim(gt.mx)
# Fraction of NA genotypes after filtering
sum(is.na(gt.mx))/(dim(gt.mx)[1]*dim(gt.mx)[2]) # ~8%
# Call rates per variant after filtering
x <- ncol(gt.mx)
y <- apply(gt.mx,1,function(z){1-sum(is.na(z))/x})
hist(y, xlim=c(0,1), breaks=10, xlab=NULL, main="Call rates per variant after gq+dp+cr genotypes filtering")
# Histogram of gq  after filtering (when gt is not NA !)
hist(gq.mx[!is.na(gt.mx)], xlim=c(0,100), breaks=50, main="Histogram of gq in non-NA genotypes (after gq+dp+cr filtering)", xlab=NULL)
# Histogram of dp  after filtering (when gt is not NA !)
hist(dp.mx[!is.na(gt.mx)], breaks=50, main="Histogram of dp in non-NA genotypes (after gq+dp+cr filtering)", xlab=NULL)
hist(dp.mx[!is.na(gt.mx)], breaks=500, xlim=c(0,100), main="Histogram of dp in non-NA genotypes (after gq+dp+cr filtering, 0:100)", xlab=NULL)
# Clean-up
rm(x, y)
mean(gq.mx, na.rm=TRUE)
mean(dp.mx, na.rm=TRUE)
rm(gq.mx, dp.mx)
dim(gt.mx)
class(gt.mx)
gt.mx[1:5,1:5]
dim(gq.mx)
library(SKAT)
power_480 <- Power_Logistic(
N.Sample.ALL = 480,
Case.Prop=0.5,
SubRegion.Length=3000,
Causal.MAF.Cutoff=0.03,
Causal.Percent= 20,
N.Sim=100,
MaxOR=2, OR.Type = "Fixed")
power_3731 <- Power_Logistic(
N.Sample.ALL = 3731,
Case.Prop=0.41,
SubRegion.Length=3000,
Causal.MAF.Cutoff=0.03,
Causal.Percent= 20,
N.Sim=100,
MaxOR=2, OR.Type = "Fixed")
power_480
power_3731
power_480 <- Power_Logistic(
N.Sample.ALL = 480,
Case.Prop=0.5,
SubRegion.Length=3000,
Causal.MAF.Cutoff=0.03,
Causal.Percent= 50,
N.Sim=100,
MaxOR=2, OR.Type = "Fixed")
power_3731 <- Power_Logistic(
N.Sample.ALL = 3731,
Case.Prop=0.41,
SubRegion.Length=3000,
Causal.MAF.Cutoff=0.03,
Causal.Percent= 50,
N.Sim=100,
MaxOR=2, OR.Type = "Fixed")
power_480
power_3731
power_480 <- Power_Logistic(
N.Sample.ALL = 480,
Case.Prop=0.5,
SubRegion.Length=3000,
Causal.MAF.Cutoff=0.05,
Causal.Percent= 50,
N.Sim=100,
MaxOR=2, OR.Type = "Fixed")
power_3731 <- Power_Logistic(
N.Sample.ALL = 3731,
Case.Prop=0.41,
SubRegion.Length=3000,
Causal.MAF.Cutoff=0.05,
Causal.Percent= 50,
N.Sim=100,
MaxOR=2, OR.Type = "Fixed")
power_480
power_3731
Power_Logistic
library(SKAT)
?Power_Logistic
library(plotly)
library(ggplot)
.libPath()
.libPaths()
.libPaths("/scratch/medgen/tools/r/R-3.3.2/lib64/R/library")
.libPaths()
library(ggplot)
library(plotly)
# Chunk 1: start_section
# Start time
Sys.time()
# Folders
setwd("/scratch/medgen/scripts/wecare_stat_01.17/scripts")
interim_data_folder <- "/scratch/medgen/scripts/wecare_stat_01.17/interim_data"
# Load libraries
library(survival) # for clogit (matched analysis)
library(VennDiagram)
# Chunk 2: load_data
# Load data
load(paste(interim_data_folder, "s07a_filter_by_variant_effect_wecare_only_jan2017.RData", sep="/"))
# Chunk 3: check_data
ls()
dim(wecare_genotypes.mx)
class(wecare_genotypes.mx)
wecare_genotypes.mx[1:5,1:5]
dim(wecare_phenotypes.df)
str(wecare_phenotypes.df)
wecare_phenotypes.df[1:5,1:5]
dim(wecare_variants.df)
colnames(wecare_variants.df)
wecare_variants.df[1:5,1:5]
dim(wecare_kgen.df)
colnames(wecare_kgen.df)
wecare_kgen.df[1:5,1:5]
dim(wecare_exac.df)
colnames(wecare_exac.df)
wecare_exac.df[1:5,1:5]
# Check consistency of rownames and colnames
sum(colnames(wecare_genotypes.mx) != rownames(wecare_phenotypes.df))
sum(rownames(wecare_genotypes.mx) != rownames(wecare_variants.df))
sum(rownames(wecare_genotypes.mx) != rownames(wecare_kgen.df))
sum(rownames(wecare_genotypes.mx) != rownames(wecare_exac.df))
# Chunk 4: prepare_data_for_analysis
# Eigenvectors
eigenvectors <- as.matrix(wecare_phenotypes.df[,c("eig1_wes", "eig2_wes", "eig3_wes")])
sum(is.na(eigenvectors)) # 0
# Matching variables
matching_variables <- as.matrix(wecare_phenotypes.df[,c("age_dx", "rstime")])
sum(is.na(matching_variables)) # 0
# Matched pairs IDs
pairID <- wecare_phenotypes.df$setno
sum(is.na(pairID))
# Make a variable for hormone treatment.
# There is one case with no data on endocrine treatment
# It could be imputed; however, it is not needed because
# treatment is combined endo- and chemo (see below)
hormone <- wecare_phenotypes.df$hormone
sum(hormone, na.rm=TRUE)
sum(is.na(hormone))
# Make variable for cytotoxic treatment
summary(as.factor(wecare_phenotypes.df$chemo_cat))
chemo <- wecare_phenotypes.df$chemo_cat != "no"
sum(chemo)
sum(is.na(chemo))
# Plot venn diagram of chemo and hormone
grid.newpage()
draw.pairwise.venn(
area1=sum(hormone, na.rm=TRUE),
area2=sum(chemo),
cross.area=sum(hormone & chemo, na.rm=TRUE),
category=c(
paste("hormone\n", sum(hormone, na.rm=TRUE)),
paste("chemo\n", sum(chemo))),
fill=c("red", "blue"),
alpha = c(0.3, 0.3),
cex=2, cat.fontface=4, fontfamily=3)
# Make joined treatment variable
treatment <- as.numeric(chemo | hormone)
sum(is.na(treatment))
sum(treatment)
# Explore case with missed hormone data:
# no need in treatment imputation because it receives cytotoxic treatment anyway
wecare_phenotypes.df[is.na(wecare_phenotypes.df$hormone),c("wes_id","hormone","chemo_cat")]
# Number of pregnancies
num_preg <- wecare_phenotypes.df$num_preg
sum(is.na(num_preg))
summary(as.factor(num_preg))
# Outcomes
Y <- wecare_phenotypes.df$cc
sum(is.na(Y))
# Genes
genes <- wecare_variants.df$SYMBOL
sum(is.na(genes))
# Raw AFs headers
raw_afs_cols <- c(
"ac_wecare_cln", "an_wecare_cln", "af_wecare_cln",
"ac_ubc_cln", "an_ubc_cln", "af_ubc_cln",
"ac_cbc_cln", "an_cbc_cln", "af_cbc_cln",
"ac_ubc_fam_cln", "an_ubc_fam_cln", "af_ubc_fam_cln",
"ac_ubc_nofam_cln", "an_ubc_nofam_cln", "af_ubc_nofam_cln",
"ac_cbc_fam_cln", "an_cbc_fam_cln", "af_cbc_fam_cln",
"ac_cbc_nofam_cln", "an_cbc_nofam_cln", "af_cbc_nofam_cln")
# Output AFs headers (w/o "_cln")
afs_cols <- c(
"ac_wecare", "an_wecare", "af_wecare",
"ac_ubc", "an_ubc", "af_ubc",
"ac_cbc", "an_cbc", "af_cbc",
"ac_ubc_fam", "an_ubc_fam", "af_ubc_fam",
"ac_ubc_nofam", "an_ubc_nofam", "af_ubc_nofam",
"ac_cbc_fam", "an_cbc_fam", "af_cbc_fam",
"ac_cbc_nofam", "an_cbc_nofam", "af_cbc_nofam")
# Clean-up
rm(chemo, hormone)
genes <- as.vector(wecare_variants.df$SYMBOL)
sum(is.na(genes))
rm(list=ls())
results_table <- read.table(paste(results_folder, "s08a_matched_analysis_wecare_only_jan2017.txt", sep="/"), header = TRUE)
# Start time
Sys.time()
# Folders
setwd("/scratch/medgen/scripts/wecare_stat_01.17/scripts")
interim_data_folder <- "/scratch/medgen/scripts/wecare_stat_01.17/interim_data"
# Load libraries
library(survival) # for clogit (matched analysis)
library(VennDiagram)
results_table <- read.table(paste(results_folder, "s08a_matched_analysis_wecare_only_jan2017.txt", sep="/"), header = TRUE)
# Load data
load(paste(interim_data_folder, "s07a_filter_by_variant_effect_wecare_only_jan2017.RData", sep="/"))
ls()
dim(wecare_genotypes.mx)
class(wecare_genotypes.mx)
wecare_genotypes.mx[1:5,1:5]
dim(wecare_phenotypes.df)
str(wecare_phenotypes.df)
wecare_phenotypes.df[1:5,1:5]
dim(wecare_variants.df)
colnames(wecare_variants.df)
wecare_variants.df[1:5,1:5]
dim(wecare_kgen.df)
colnames(wecare_kgen.df)
wecare_kgen.df[1:5,1:5]
dim(wecare_exac.df)
colnames(wecare_exac.df)
wecare_exac.df[1:5,1:5]
# Check consistency of rownames and colnames
sum(colnames(wecare_genotypes.mx) != rownames(wecare_phenotypes.df))
sum(rownames(wecare_genotypes.mx) != rownames(wecare_variants.df))
sum(rownames(wecare_genotypes.mx) != rownames(wecare_kgen.df))
sum(rownames(wecare_genotypes.mx) != rownames(wecare_exac.df))
# Eigenvectors
eigenvectors <- as.matrix(wecare_phenotypes.df[,c("eig1_wes", "eig2_wes", "eig3_wes")])
sum(is.na(eigenvectors)) # 0
# Matching variables
matching_variables <- as.matrix(wecare_phenotypes.df[,c("age_dx", "rstime")])
sum(is.na(matching_variables)) # 0
# Matched pairs IDs
pairID <- wecare_phenotypes.df$setno
sum(is.na(pairID))
# Make a variable for hormone treatment.
# There is one case with no data on endocrine treatment
# It could be imputed; however, it is not needed because
# treatment is combined endo- and chemo (see below)
hormone <- wecare_phenotypes.df$hormone
sum(hormone, na.rm=TRUE)
sum(is.na(hormone))
# Make variable for cytotoxic treatment
summary(as.factor(wecare_phenotypes.df$chemo_cat))
chemo <- wecare_phenotypes.df$chemo_cat != "no"
sum(chemo)
sum(is.na(chemo))
# Plot venn diagram of chemo and hormone
grid.newpage()
draw.pairwise.venn(
area1=sum(hormone, na.rm=TRUE),
area2=sum(chemo),
cross.area=sum(hormone & chemo, na.rm=TRUE),
category=c(
paste("hormone\n", sum(hormone, na.rm=TRUE)),
paste("chemo\n", sum(chemo))),
fill=c("red", "blue"),
alpha = c(0.3, 0.3),
cex=2, cat.fontface=4, fontfamily=3)
# Make joined treatment variable
treatment <- as.numeric(chemo | hormone)
sum(is.na(treatment))
sum(treatment)
# Explore case with missed hormone data:
# no need in treatment imputation because it receives cytotoxic treatment anyway
wecare_phenotypes.df[is.na(wecare_phenotypes.df$hormone),c("wes_id","hormone","chemo_cat")]
# Number of pregnancies
num_preg <- wecare_phenotypes.df$num_preg
sum(is.na(num_preg))
summary(as.factor(num_preg))
# Outcomes
Y <- wecare_phenotypes.df$cc
sum(is.na(Y))
# Genes
genes <- as.vector(wecare_variants.df$SYMBOL)
sum(is.na(genes))
# Raw AFs headers
raw_afs_cols <- c(
"ac_wecare_cln", "an_wecare_cln", "af_wecare_cln",
"ac_ubc_cln", "an_ubc_cln", "af_ubc_cln",
"ac_cbc_cln", "an_cbc_cln", "af_cbc_cln",
"ac_ubc_fam_cln", "an_ubc_fam_cln", "af_ubc_fam_cln",
"ac_ubc_nofam_cln", "an_ubc_nofam_cln", "af_ubc_nofam_cln",
"ac_cbc_fam_cln", "an_cbc_fam_cln", "af_cbc_fam_cln",
"ac_cbc_nofam_cln", "an_cbc_nofam_cln", "af_cbc_nofam_cln")
# Output AFs headers (w/o "_cln")
afs_cols <- c(
"ac_wecare", "an_wecare", "af_wecare",
"ac_ubc", "an_ubc", "af_ubc",
"ac_cbc", "an_cbc", "af_cbc",
"ac_ubc_fam", "an_ubc_fam", "af_ubc_fam",
"ac_ubc_nofam", "an_ubc_nofam", "af_ubc_nofam",
"ac_cbc_fam", "an_cbc_fam", "af_cbc_fam",
"ac_cbc_nofam", "an_cbc_nofam", "af_cbc_nofam")
# Clean-up
rm(chemo, hormone)
results_table <- read.table(paste(results_folder, "s08a_matched_analysis_wecare_only_jan2017.txt", sep="/"), header = TRUE)
View(results_table)
genes[35:37]
